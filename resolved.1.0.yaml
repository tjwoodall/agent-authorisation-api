openapi: 3.0.3
info:
  title: Agent Authorisation
  description: |2-

    # Overview
    You can find more information about this API in the [agent-authorisation-api](https://github.com/hmrc/agent-authorisation-api/blob/main/README.md) GitHub repository.
    # Changelog
    You can find the changelog in the [agent-authorisation-api](https://github.com/hmrc/agent-authorisation-api/blob/main/CHANGE_LOG.md) GitHub repository.
  version: "1.0"
servers:
- url: https://test-api.service.hmrc.gov.uk/
  description: Sandbox
- url: https://api.service.hmrc.gov.uk/
  description: Production
tags:
- name: Agents
  description: ""
paths:
  /agents/{arn}/invitations:
    get:
      tags:
      - Agents
      summary: Get all authorisation requests for the last 30 days
      operationId: Getallauthorisationrequestsforthelast30days
      parameters:
      - name: arn
        in: path
        description: "The Making Tax Digital (MTD) platform Agent Reference Number.\
          \ For format and validation of Agent Reference Number [See here](https://github.com/hmrc/agent-authorisation-api/tree/main/app/uk/gov/hmrc/agentauthorisation/models/Arn.scala)"
        required: true
        style: simple
        explode: false
        schema:
          type: string
          example: AARN9999999
      - name: Accept
        in: header
        description: "Specifies the response format and the [version](/api-documentation/docs/reference-guide#versioning)\
          \ of the API to be used."
        required: true
        style: simple
        explode: false
        schema:
          type: string
          enum:
          - application/vnd.hmrc.1.0+json
      responses:
        "200":
          description: A list of authorisation requests
          content:
            application/json:
              schema:
                type: array
                description: Returns all authorisation requests for the last 30 days.
                items:
                  title: AgentsInvitationsResponse
                  required:
                  - _links
                  - arn
                  - created
                  - service
                  - status
                  type: object
                  properties:
                    _links:
                      required:
                      - self
                      type: object
                      properties:
                        self:
                          required:
                          - href
                          type: object
                          properties:
                            href:
                              type: string
                          description: A link to the current resource.
                      description: The link to the invitation
                    service:
                      maxItems: 1
                      type: array
                      description: The service to which this invitation refers
                      items:
                        oneOf:
                        - title: MTD-IT
                          type: string
                          description: MTD IT service
                        - title: MTD-VAT
                          type: string
                          description: MTD VAT service
                    arn:
                      type: string
                      description: The Agent Registration Number for the calling agency
                    created:
                      type: string
                      description: Creation time of the request (RFC3339 / ISO8601
                        format)
                      format: date-time
                    updated:
                      type: string
                      description: Update time of the request (RFC3339 / ISO8601 format)
                      format: date-time
                    expiresOn:
                      type: string
                      description: Expiration time of the request (RFC3339 / ISO8601
                        format)
                      format: date
                    status:
                      type: string
                      description: The current status of the invitation
                      enum:
                      - Pending
                      - Accepted
                      - Rejected
                      - Cancelled
                      - Deauthorised
                      - Expired
                      - Partialauth
                    clientActionUrl:
                      type: string
                      description: Link for the client to authorise/reject this agent's
                        invitation.
                      format: uri
                    agentType:
                      type: string
                      description: Only MTD-IT supports this field. Defaults to "main"
                        if omitted.
                      nullable: true
                      enum:
                      - main
                      - supporting
              examples:
                pending and responded:
                  value:
                    $ref: ./examples/get-agency-invitations-example.json
        "204":
          description: The agent has no authorisation requests in the last 30 days
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                notAnAgent:
                  value:
                    $ref: ./examples/errors/forbidden_notAgent.json
                agentNotSubscribed:
                  value:
                    $ref: ./examples/errors/forbidden_agentNotSubscribed.json
                noPermissionOnAgency:
                  value:
                    $ref: ./examples/errors/forbidden_noPermissionOnAgency.json
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                unsupportedVersion:
                  value:
                    $ref: ./examples/errors/badReq_invalidVersionAcceptHeader.json
                badRequest:
                  value:
                    $ref: ./examples/errors/badReq.json
        "406":
          description: Not Acceptable
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                acceptHeaderMissing:
                  value:
                    $ref: ./examples/errors/notAcceptable_headerMissing.json
                acceptHeaderInvalid:
                  value:
                    $ref: ./examples/errors/notAcceptable_headerInvalid.json
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                unauthorizedRequest:
                  value:
                    code: UNAUTHORIZED
                    message: Bearer token is missing or not authorized.
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                internalServerErrorExample:
                  value:
                    $ref: ./examples/errors/internalServerError.json
      deprecated: false
      security:
      - userRestricted:
        - read:sent-invitations
    post:
      tags:
      - Agents
      summary: Create a new authorisation
      description: Create a new authorisation request. The request will expire after
        21 days.
      operationId: Createanewauthorisation
      parameters:
      - name: arn
        in: path
        description: "The Making Tax Digital (MTD) platform Agent Reference Number.\
          \ For format and validation of Agent Reference Number [See here](https://github.com/hmrc/agent-authorisation-api/tree/main/app/uk/gov/hmrc/agentauthorisation/models/Arn.scala)"
        required: true
        style: simple
        explode: false
        schema:
          type: string
          example: AARN9999999
      - name: Accept
        in: header
        description: "Specifies the response format and the [version](/api-documentation/docs/reference-guide#versioning)\
          \ of the API to be used."
        required: true
        style: simple
        explode: false
        schema:
          type: string
          enum:
          - application/vnd.hmrc.1.0+json
      - name: Content-Type
        in: header
        description: The media type of the request body.
        required: true
        style: simple
        explode: false
        schema:
          type: string
          enum:
          - application/json
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
              - title: Agent Invitation Request for MTD-IT
                required:
                - clientId
                - clientIdType
                - clientType
                - knownFact
                - service
                type: object
                properties:
                  service:
                    type: string
                    description: MTD IT service
                  clientType:
                    type: string
                    description: An individual or sole trader
                  clientIdType:
                    type: string
                  clientId:
                    pattern: "^[ABCEGHJKLMNOPRSTWXYZ][ABCEGHJKLMNPRSTWXYZ]?\\d{2}?\\\
                      d{2}?\\d{2}?[A-D]{1}$"
                    type: string
                  knownFact:
                    pattern: "^[A-Z]{1,2}[0-9][0-9A-Z]?\\s?[0-9][A-Z]{2}$|BFPO\\s?[0-9]{1,5}$"
                    type: string
                  agentType:
                    type: string
                    description: Only MTD-IT supports this field. Defaults to "main"
                      if omitted.
                    nullable: true
                    enum:
                    - main
                    - supporting
              - title: Agent Invitation Request for VAT
                required:
                - clientId
                - clientIdType
                - clientType
                - knownFact
                - service
                type: object
                properties:
                  service:
                    type: string
                    description: MTD VAT service
                  clientType:
                    oneOf:
                    - title: personal
                      type: string
                      description: An individual or sole trader
                    - title: business
                      type: string
                      description: A company or partnership
                  clientIdType:
                    type: string
                  clientId:
                    pattern: "^[0-9]{1,9}$"
                    type: string
                  knownFact:
                    pattern: yyyy-mm-dd
                    type: string
            examples:
              example-ITSA:
                value:
                  $ref: ./examples/post-agency-invitations-itsa-example.json
              example-ITSA-main:
                value:
                  $ref: ./examples/post-agency-invitations-itsa-main-example.json
              example-ITSA-supporting:
                value:
                  $ref: ./examples/post-agency-invitations-itsa-supp-example.json
              example-VAT:
                value:
                  $ref: ./examples/post-agency-invitations-vat-example.json
        required: true
      responses:
        "204":
          description: The request was accepted and an authorisation request has been
            created
          headers:
            Location:
              description: Location of the authorisation request.
              style: simple
              explode: false
              schema:
                type: string
                example: /agents/AARN9999999/invitations/CS5AK7O8FPC43
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                serviceNotSupported:
                  value:
                    $ref: ./examples/errors/badReq_serviceNotSupported.json
                invalidClientType:
                  value:
                    $ref: ./examples/errors/badReq_clientTypeNotSupported.json
                invalidClientId:
                  value:
                    $ref: ./examples/errors/badReq_clientIdFormatInvalid.json
                clientIdDoesNotMatchService:
                  value:
                    $ref: ./examples/errors/badReq_clientIdServiceMatchError.json
                invalidPostcode:
                  value:
                    $ref: ./examples/errors/badReq_postcodeFormatInvalid.json
                invalidVatRegistrationDate:
                  value:
                    $ref: ./examples/errors/badReq_vatRegDateFormatInvalid.json
                unsupportedVersion:
                  value:
                    $ref: ./examples/errors/badReq_invalidVersionAcceptHeader.json
                unsupportedContentType:
                  value:
                    $ref: ./examples/errors/badReq_unsupportedContentType.json
                unsupportedAgentType:
                  value:
                    $ref: ./examples/errors/badReq_unsupportedAgentType.json
                badRequest:
                  value:
                    $ref: ./examples/errors/badReq.json
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                unauthorizedRequest:
                  value:
                    code: UNAUTHORIZED
                    message: Bearer token is missing or not authorized.
        "403":
          description: Forbidden
          headers:
            Location:
              description: Location of the authorisation request. (Only returned with
                duplicateAuthorisationRequest)
              style: simple
              explode: false
              schema:
                type: string
                example: /agents/AARN9999999/invitations/CS5AK7O8FPC43
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                clientRegistrationNotFound:
                  value:
                    $ref: ./examples/errors/forbidden_clientRegNotFound.json
                postcodeNoMatch:
                  value:
                    $ref: ./examples/errors/forbidden_postcodeNoMatch.json
                vatRegistrationDateNoMatch:
                  value:
                    $ref: ./examples/errors/forbidden_vatRegDateNoMatch.json
                duplicateAuthorisationRequest:
                  value:
                    $ref: ./examples/errors/forbidden_duplicateAuthReq.json
                alreadyAuthorised:
                  value:
                    $ref: ./examples/errors/forbidden_alreadyAuthorised.json
                notAnAgent:
                  value:
                    $ref: ./examples/errors/forbidden_notAgent.json
                agentNotSubscribed:
                  value:
                    $ref: ./examples/errors/forbidden_agentNotSubscribed.json
                noPermissionOnAgency:
                  value:
                    $ref: ./examples/errors/forbidden_noPermissionOnAgency.json
                vatClientInsolvent:
                  value:
                    $ref: ./examples/errors/forbidden_vatClientInsolvent.json
                alreadyProcessing:
                  value:
                    $ref: ./examples/errors/forbidden_alreadyProcessing.json
        "406":
          description: Not Acceptable
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                acceptHeaderMissing:
                  value:
                    $ref: ./examples/errors/notAcceptable_headerMissing.json
                acceptHeaderInvalid:
                  value:
                    $ref: ./examples/errors/notAcceptable_headerInvalid.json
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                internalServerErrorExample:
                  value:
                    $ref: ./examples/errors/internalServerError.json
      deprecated: false
      security:
      - userRestricted:
        - write:sent-invitations
  /agents/{arn}/invitations/{invitationId}:
    get:
      tags:
      - Agents
      summary: Get an invitation by id
      operationId: Getaninvitationbyid
      parameters:
      - name: arn
        in: path
        description: "The Making Tax Digital (MTD) platform Agent Reference Number.\
          \ For format and validation of Agent Reference Number [See here](https://github.com/hmrc/agent-authorisation-api/tree/main/app/uk/gov/hmrc/agentauthorisation/models/Arn.scala)"
        required: true
        style: simple
        explode: false
        schema:
          type: string
          example: AARN9999999
      - name: invitationId
        in: path
        description: A unique authorisation request ID
        required: true
        style: simple
        explode: false
        schema:
          type: string
          example: CS5AK7O8FPC43
      - name: Accept
        in: header
        description: "Specifies the response format and the [version](/api-documentation/docs/reference-guide#versioning)\
          \ of the API to be used."
        required: true
        style: simple
        explode: false
        schema:
          type: string
          enum:
          - application/vnd.hmrc.1.0+json
      responses:
        "200":
          description: The authorisation request
          content:
            application/json:
              schema:
                title: AgentsInvitationsResponse
                required:
                - _links
                - arn
                - created
                - service
                - status
                type: object
                properties:
                  _links:
                    required:
                    - self
                    type: object
                    properties:
                      self:
                        required:
                        - href
                        type: object
                        properties:
                          href:
                            type: string
                        description: A link to the current resource.
                    description: The link to the invitation
                  service:
                    maxItems: 1
                    type: array
                    description: The service to which this invitation refers
                    items:
                      oneOf:
                      - title: MTD-IT
                        type: string
                        description: MTD IT service
                      - title: MTD-VAT
                        type: string
                        description: MTD VAT service
                  arn:
                    type: string
                    description: The Agent Registration Number for the calling agency
                  created:
                    type: string
                    description: Creation time of the request (RFC3339 / ISO8601 format)
                    format: date-time
                  updated:
                    type: string
                    description: Update time of the request (RFC3339 / ISO8601 format)
                    format: date-time
                  expiresOn:
                    type: string
                    description: Expiration time of the request (RFC3339 / ISO8601
                      format)
                    format: date
                  status:
                    type: string
                    description: The current status of the invitation
                    enum:
                    - Pending
                    - Accepted
                    - Rejected
                    - Cancelled
                    - Deauthorised
                    - Expired
                    - Partialauth
                  clientActionUrl:
                    type: string
                    description: Link for the client to authorise/reject this agent's
                      invitation.
                    format: uri
                  agentType:
                    type: string
                    description: Only MTD-IT supports this field. Defaults to "main"
                      if omitted.
                    nullable: true
                    enum:
                    - main
                    - supporting
              examples:
                pending:
                  value:
                    $ref: ./examples/get-agency-invitation-pending-example.json
                responded:
                  value:
                    $ref: ./examples/get-agency-invitation-responded-example.json
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                notAnAgent:
                  value:
                    $ref: ./examples/errors/forbidden_notAgent.json
                agentNotSubscribed:
                  value:
                    $ref: ./examples/errors/forbidden_agentNotSubscribed.json
                noPermissionOnAgency:
                  value:
                    $ref: ./examples/errors/forbidden_noPermissionOnAgency.json
        "404":
          description: Not Found
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                invitationNotFound:
                  value:
                    code: INVITATION_NOT_FOUND
                    message: The authorisation request cannot be found.
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                unsupportedVersion:
                  value:
                    $ref: ./examples/errors/badReq_invalidVersionAcceptHeader.json
                badRequest:
                  value:
                    $ref: ./examples/errors/badReq.json
        "406":
          description: Not Acceptable
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                acceptHeaderMissing:
                  value:
                    $ref: ./examples/errors/notAcceptable_headerMissing.json
                acceptHeaderInvalid:
                  value:
                    $ref: ./examples/errors/notAcceptable_headerInvalid.json
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                unauthorizedRequest:
                  value:
                    code: UNAUTHORIZED
                    message: Bearer token is missing or not authorized.
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                internalServerErrorExample:
                  value:
                    $ref: ./examples/errors/internalServerError.json
      deprecated: false
      security:
      - userRestricted:
        - read:sent-invitations
    delete:
      tags:
      - Agents
      summary: Cancel an invitation by id
      operationId: Cancelaninvitationbyid
      parameters:
      - name: arn
        in: path
        description: "The Making Tax Digital (MTD) platform Agent Reference Number.\
          \ For format and validation of Agent Reference Number [See here](https://github.com/hmrc/agent-authorisation-api/tree/main/app/uk/gov/hmrc/agentauthorisation/models/Arn.scala)"
        required: true
        style: simple
        explode: false
        schema:
          type: string
          example: AARN9999999
      - name: invitationId
        in: path
        description: A unique authorisation request ID
        required: true
        style: simple
        explode: false
        schema:
          type: string
          example: CS5AK7O8FPC43
      - name: Accept
        in: header
        description: "Specifies the response format and the [version](/api-documentation/docs/reference-guide#versioning)\
          \ of the API to be used."
        required: true
        style: simple
        explode: false
        schema:
          type: string
          enum:
          - application/vnd.hmrc.1.0+json
      - name: Content-Type
        in: header
        description: The media type of the request body.
        required: true
        style: simple
        explode: false
        schema:
          type: string
          enum:
          - application/json
      responses:
        "204":
          description: The authorisation request has been cancelled
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                invalidInvitationStatus:
                  value:
                    $ref: ./examples/errors/forbidden_invalidInvitationStatus.json
                notAnAgent:
                  value:
                    $ref: ./examples/errors/forbidden_notAgent.json
                agentNotSubscribed:
                  value:
                    $ref: ./examples/errors/forbidden_agentNotSubscribed.json
                noPermissionOnAgency:
                  value:
                    $ref: ./examples/errors/forbidden_noPermissionOnAgency.json
        "404":
          description: Not Found
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                invitationNotFound:
                  value:
                    code: INVITATION_NOT_FOUND
                    message: The authorisation request cannot be found.
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                unsupportedVersion:
                  value:
                    $ref: ./examples/errors/badReq_invalidVersionAcceptHeader.json
                badRequest:
                  value:
                    $ref: ./examples/errors/badReq.json
        "406":
          description: Not Acceptable
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                acceptHeaderMissing:
                  value:
                    $ref: ./examples/errors/notAcceptable_headerMissing.json
                acceptHeaderInvalid:
                  value:
                    $ref: ./examples/errors/notAcceptable_headerInvalid.json
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                unauthorizedRequest:
                  value:
                    code: UNAUTHORIZED
                    message: Bearer token is missing or not authorized.
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                internalServerErrorExample:
                  value:
                    $ref: ./examples/errors/internalServerError.json
      deprecated: false
      security:
      - userRestricted:
        - write:cancel-invitations
  /agents/{arn}/relationships:
    post:
      tags:
      - Agents
      summary: Get Status of a Relationship
      operationId: GetStatusofaRelationship
      parameters:
      - name: arn
        in: path
        description: "The Making Tax Digital (MTD) platform Agent Reference Number.\
          \ For format and validation of Agent Reference Number [See here](https://github.com/hmrc/agent-authorisation-api/tree/main/app/uk/gov/hmrc/agentauthorisation/models/Arn.scala)"
        required: true
        style: simple
        explode: false
        schema:
          type: string
          example: AARN9999999
      - name: Accept
        in: header
        description: "Specifies the response format and the [version](/api-documentation/docs/reference-guide#versioning)\
          \ of the API to be used."
        required: true
        style: simple
        explode: false
        schema:
          type: string
          enum:
          - application/vnd.hmrc.1.0+json
      - name: Content-Type
        in: header
        description: The media type of the request body.
        required: true
        style: simple
        explode: false
        schema:
          type: string
          enum:
          - application/json
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
              - title: Check Status of Relationship Request for MTD-VAT
                required:
                - clientId
                - clientIdType
                - knownFact
                - service
                type: object
                properties:
                  service:
                    type: string
                    description: MTD VAT service
                  clientIdType:
                    type: string
                  clientId:
                    pattern: "^[0-9]{1,9}$"
                    type: string
                  knownFact:
                    pattern: yyyy-mm-dd
                    type: string
              - title: Check Status of Relationship Request for MTD-IT
                required:
                - clientId
                - clientIdType
                - knownFact
                - service
                type: object
                properties:
                  service:
                    type: string
                    description: MTD IT service
                  clientIdType:
                    type: string
                  clientId:
                    pattern: "^[ABCEGHJKLMNOPRSTWXYZ][ABCEGHJKLMNPRSTWXYZ]?\\d{2}?\\\
                      d{2}?\\d{2}?[A-D]{1}$"
                    type: string
                  knownFact:
                    pattern: "^[A-Z]{1,2}[0-9][0-9A-Z]?\\s?[0-9][A-Z]{2}$|BFPO\\s?[0-9]{1,5}$"
                    type: string
                  agentType:
                    type: string
                    description: Only MTD-IT supports this field. Defaults to "main"
                      if omitted.
                    nullable: true
                    enum:
                    - main
                    - supporting
            examples:
              example-ITSA:
                value:
                  $ref: ./examples/post-agency-check-relationship-itsa-example.json
              example-ITSA-main:
                value:
                  $ref: ./examples/post-agency-check-relationship-itsa-main-example.json
              example-ITSA-supporting:
                value:
                  $ref: ./examples/post-agency-check-relationship-itsa-supp-example.json
              example-VAT:
                value:
                  $ref: ./examples/post-agency-check-relationship-vat-example.json
        required: true
      responses:
        "204":
          description: The agent is authorised to act for the client.
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                clientRegistrationNotFound:
                  value:
                    $ref: ./examples/errors/forbidden_clientRegNotFound.json
                postcodeNoMatch:
                  value:
                    $ref: ./examples/errors/forbidden_postcodeNoMatch.json
                vatRegistrationDateNoMatch:
                  value:
                    $ref: ./examples/errors/forbidden_vatRegDateNoMatch.json
                notAnAgent:
                  value:
                    $ref: ./examples/errors/forbidden_notAgent.json
                agentNotSubscribed:
                  value:
                    $ref: ./examples/errors/forbidden_agentNotSubscribed.json
                noPermissionOnAgency:
                  value:
                    $ref: ./examples/errors/forbidden_noPermissionOnAgency.json
                vatClientInsolvent:
                  value:
                    $ref: ./examples/errors/forbidden_vatClientInsolvent.json
        "404":
          description: Not Found
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                relationshipNotFound:
                  value:
                    code: RELATIONSHIP_NOT_FOUND
                    message: Relationship is inactive. Agent is not authorised to
                      act for this client.
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                serviceNotSupported:
                  value:
                    $ref: ./examples/errors/badReq_serviceNotSupported.json
                invalidClientId:
                  value:
                    $ref: ./examples/errors/badReq_clientIdFormatInvalid.json
                clientIdDoesNotMatchService:
                  value:
                    $ref: ./examples/errors/badReq_clientIdServiceMatchError.json
                invalidPostcode:
                  value:
                    $ref: ./examples/errors/badReq_postcodeFormatInvalid.json
                invalidVatRegistrationDate:
                  value:
                    $ref: ./examples/errors/badReq_vatRegDateFormatInvalid.json
                unsupportedVersion:
                  value:
                    $ref: ./examples/errors/badReq_invalidVersionAcceptHeader.json
                unsupportedContentType:
                  value:
                    $ref: ./examples/errors/badReq_unsupportedContentType.json
                unsupportedAgentType:
                  value:
                    $ref: ./examples/errors/badReq_unsupportedAgentType.json
                badRequest:
                  value:
                    $ref: ./examples/errors/badReq.json
        "406":
          description: Not Acceptable
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                acceptHeaderMissing:
                  value:
                    $ref: ./examples/errors/notAcceptable_headerMissing.json
                acceptHeaderInvalid:
                  value:
                    $ref: ./examples/errors/notAcceptable_headerInvalid.json
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                unauthorizedRequest:
                  value:
                    code: UNAUTHORIZED
                    message: Bearer token is missing or not authorized.
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                required:
                - code
                - message
                type: object
                properties:
                  code:
                    type: string
                  message:
                    type: string
              examples:
                internalServerErrorExample:
                  value:
                    $ref: ./examples/errors/internalServerError.json
      deprecated: false
      security:
      - userRestricted:
        - read:check-relationship
components:
  schemas:
    Error:
      required:
      - code
      - message
      type: object
      properties:
        code:
          type: string
        message:
          type: string
    AgentsInvitationsITSARequest:
      title: Agent Invitation Request for MTD-IT
      required:
      - clientId
      - clientIdType
      - clientType
      - knownFact
      - service
      type: object
      properties:
        service:
          type: string
          description: MTD IT service
        clientType:
          type: string
          description: An individual or sole trader
        clientIdType:
          type: string
        clientId:
          pattern: "^[ABCEGHJKLMNOPRSTWXYZ][ABCEGHJKLMNPRSTWXYZ]?\\d{2}?\\d{2}?\\\
            d{2}?[A-D]{1}$"
          type: string
        knownFact:
          pattern: "^[A-Z]{1,2}[0-9][0-9A-Z]?\\s?[0-9][A-Z]{2}$|BFPO\\s?[0-9]{1,5}$"
          type: string
        agentType:
          type: string
          description: Only MTD-IT supports this field. Defaults to "main" if omitted.
          nullable: true
          enum:
          - main
          - supporting
    AgentsInvitationsVATRequest:
      title: Agent Invitation Request for VAT
      required:
      - clientId
      - clientIdType
      - clientType
      - knownFact
      - service
      type: object
      properties:
        service:
          type: string
          description: MTD VAT service
        clientType:
          oneOf:
          - title: personal
            type: string
            description: An individual or sole trader
          - title: business
            type: string
            description: A company or partnership
        clientIdType:
          type: string
        clientId:
          pattern: "^[0-9]{1,9}$"
          type: string
        knownFact:
          pattern: yyyy-mm-dd
          type: string
    CheckRelationshipVATRequest:
      title: Check Status of Relationship Request for MTD-VAT
      required:
      - clientId
      - clientIdType
      - knownFact
      - service
      type: object
      properties:
        service:
          type: string
          description: MTD VAT service
        clientIdType:
          type: string
        clientId:
          pattern: "^[0-9]{1,9}$"
          type: string
        knownFact:
          pattern: yyyy-mm-dd
          type: string
    CheckRelationshipITSARequest:
      title: Check Status of Relationship Request for MTD-IT
      required:
      - clientId
      - clientIdType
      - knownFact
      - service
      type: object
      properties:
        service:
          type: string
          description: MTD IT service
        clientIdType:
          type: string
        clientId:
          pattern: "^[ABCEGHJKLMNOPRSTWXYZ][ABCEGHJKLMNPRSTWXYZ]?\\d{2}?\\d{2}?\\\
            d{2}?[A-D]{1}$"
          type: string
        knownFact:
          pattern: "^[A-Z]{1,2}[0-9][0-9A-Z]?\\s?[0-9][A-Z]{2}$|BFPO\\s?[0-9]{1,5}$"
          type: string
        agentType:
          type: string
          description: Only MTD-IT supports this field. Defaults to "main" if omitted.
          nullable: true
          enum:
          - main
          - supporting
    ClientIdTypeNI:
      title: ni
      type: string
    ClientIdTypeVRN:
      title: vrn
      type: string
    ClientIdNINO:
      title: National Insurance Number
      pattern: "^[ABCEGHJKLMNOPRSTWXYZ][ABCEGHJKLMNPRSTWXYZ]?\\d{2}?\\d{2}?\\d{2}?[A-D]{1}$"
      type: string
    ClientIdVAT:
      title: VAT Registration Number
      pattern: "^[0-9]{1,9}$"
      type: string
    KnownFactPostcode:
      title: Postcode
      pattern: "^[A-Z]{1,2}[0-9][0-9A-Z]?\\s?[0-9][A-Z]{2}$|BFPO\\s?[0-9]{1,5}$"
      type: string
    KnownFactRegistrationDate:
      title: VAT registration date
      pattern: yyyy-mm-dd
      type: string
    AgentType:
      title: Agent type
      type: string
      description: Only MTD-IT supports this field. Defaults to "main" if omitted.
      nullable: true
      enum:
      - main
      - supporting
    AgentsInvitationsResponse:
      title: AgentsInvitationsResponse
      required:
      - _links
      - arn
      - created
      - service
      - status
      type: object
      properties:
        _links:
          required:
          - self
          type: object
          properties:
            self:
              required:
              - href
              type: object
              properties:
                href:
                  type: string
              description: A link to the current resource.
          description: The link to the invitation
        service:
          maxItems: 1
          type: array
          description: The service to which this invitation refers
          items:
            oneOf:
            - title: MTD-IT
              type: string
              description: MTD IT service
            - title: MTD-VAT
              type: string
              description: MTD VAT service
        arn:
          type: string
          description: The Agent Registration Number for the calling agency
        created:
          type: string
          description: Creation time of the request (RFC3339 / ISO8601 format)
          format: date-time
        updated:
          type: string
          description: Update time of the request (RFC3339 / ISO8601 format)
          format: date-time
        expiresOn:
          type: string
          description: Expiration time of the request (RFC3339 / ISO8601 format)
          format: date
        status:
          type: string
          description: The current status of the invitation
          enum:
          - Pending
          - Accepted
          - Rejected
          - Cancelled
          - Deauthorised
          - Expired
          - Partialauth
        clientActionUrl:
          type: string
          description: Link for the client to authorise/reject this agent's invitation.
          format: uri
        agentType:
          type: string
          description: Only MTD-IT supports this field. Defaults to "main" if omitted.
          nullable: true
          enum:
          - main
          - supporting
    VATService:
      title: MTD-VAT
      type: string
      description: MTD VAT service
    ITSAService:
      title: MTD-IT
      type: string
      description: MTD IT service
    ClientTypePersonal:
      title: personal
      type: string
      description: An individual or sole trader
    ClientTypeBusiness:
      title: business
      type: string
      description: A company or partnership
    Links:
      title: Links
      required:
      - self
      type: object
      properties:
        self:
          required:
          - href
          type: object
          properties:
            href:
              type: string
          description: A link to the current resource.
      description: A link to the current resource.
    Self:
      title: Self
      required:
      - href
      type: object
      properties:
        href:
          type: string
      description: A link to the current resource.
  responses:
    notFoundInvitation:
      description: Not Found
      content:
        application/json:
          schema:
            required:
            - code
            - message
            type: object
            properties:
              code:
                type: string
              message:
                type: string
          examples:
            invitationNotFound:
              value:
                code: INVITATION_NOT_FOUND
                message: The authorisation request cannot be found.
    notFoundRelationship:
      description: Not Found
      content:
        application/json:
          schema:
            required:
            - code
            - message
            type: object
            properties:
              code:
                type: string
              message:
                type: string
          examples:
            relationshipNotFound:
              value:
                code: RELATIONSHIP_NOT_FOUND
                message: Relationship is inactive. Agent is not authorised to act
                  for this client.
    unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            required:
            - code
            - message
            type: object
            properties:
              code:
                type: string
              message:
                type: string
          examples:
            unauthorizedRequest:
              value:
                code: UNAUTHORIZED
                message: Bearer token is missing or not authorized.
    notAcceptable:
      description: Not Acceptable
      content:
        application/json:
          schema:
            required:
            - code
            - message
            type: object
            properties:
              code:
                type: string
              message:
                type: string
          examples:
            acceptHeaderMissing:
              value:
                $ref: ./examples/errors/notAcceptable_headerMissing.json
            acceptHeaderInvalid:
              value:
                $ref: ./examples/errors/notAcceptable_headerInvalid.json
    internalServerError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            required:
            - code
            - message
            type: object
            properties:
              code:
                type: string
              message:
                type: string
          examples:
            internalServerErrorExample:
              value:
                $ref: ./examples/errors/internalServerError.json
    forbiddenDelete:
      description: Forbidden
      content:
        application/json:
          schema:
            required:
            - code
            - message
            type: object
            properties:
              code:
                type: string
              message:
                type: string
          examples:
            invalidInvitationStatus:
              value:
                $ref: ./examples/errors/forbidden_invalidInvitationStatus.json
            notAnAgent:
              value:
                $ref: ./examples/errors/forbidden_notAgent.json
            agentNotSubscribed:
              value:
                $ref: ./examples/errors/forbidden_agentNotSubscribed.json
            noPermissionOnAgency:
              value:
                $ref: ./examples/errors/forbidden_noPermissionOnAgency.json
    forbiddenCreateInvitation:
      description: Forbidden
      headers:
        Location:
          description: Location of the authorisation request. (Only returned with
            duplicateAuthorisationRequest)
          style: simple
          explode: false
          schema:
            type: string
            example: /agents/AARN9999999/invitations/CS5AK7O8FPC43
      content:
        application/json:
          schema:
            required:
            - code
            - message
            type: object
            properties:
              code:
                type: string
              message:
                type: string
          examples:
            clientRegistrationNotFound:
              value:
                $ref: ./examples/errors/forbidden_clientRegNotFound.json
            postcodeNoMatch:
              value:
                $ref: ./examples/errors/forbidden_postcodeNoMatch.json
            vatRegistrationDateNoMatch:
              value:
                $ref: ./examples/errors/forbidden_vatRegDateNoMatch.json
            duplicateAuthorisationRequest:
              value:
                $ref: ./examples/errors/forbidden_duplicateAuthReq.json
            alreadyAuthorised:
              value:
                $ref: ./examples/errors/forbidden_alreadyAuthorised.json
            notAnAgent:
              value:
                $ref: ./examples/errors/forbidden_notAgent.json
            agentNotSubscribed:
              value:
                $ref: ./examples/errors/forbidden_agentNotSubscribed.json
            noPermissionOnAgency:
              value:
                $ref: ./examples/errors/forbidden_noPermissionOnAgency.json
            vatClientInsolvent:
              value:
                $ref: ./examples/errors/forbidden_vatClientInsolvent.json
            alreadyProcessing:
              value:
                $ref: ./examples/errors/forbidden_alreadyProcessing.json
    forbiddenGetInvitations:
      description: Forbidden
      content:
        application/json:
          schema:
            required:
            - code
            - message
            type: object
            properties:
              code:
                type: string
              message:
                type: string
          examples:
            notAnAgent:
              value:
                $ref: ./examples/errors/forbidden_notAgent.json
            agentNotSubscribed:
              value:
                $ref: ./examples/errors/forbidden_agentNotSubscribed.json
            noPermissionOnAgency:
              value:
                $ref: ./examples/errors/forbidden_noPermissionOnAgency.json
    forbiddenGetRelationshipStatus:
      description: Forbidden
      content:
        application/json:
          schema:
            required:
            - code
            - message
            type: object
            properties:
              code:
                type: string
              message:
                type: string
          examples:
            clientRegistrationNotFound:
              value:
                $ref: ./examples/errors/forbidden_clientRegNotFound.json
            postcodeNoMatch:
              value:
                $ref: ./examples/errors/forbidden_postcodeNoMatch.json
            vatRegistrationDateNoMatch:
              value:
                $ref: ./examples/errors/forbidden_vatRegDateNoMatch.json
            notAnAgent:
              value:
                $ref: ./examples/errors/forbidden_notAgent.json
            agentNotSubscribed:
              value:
                $ref: ./examples/errors/forbidden_agentNotSubscribed.json
            noPermissionOnAgency:
              value:
                $ref: ./examples/errors/forbidden_noPermissionOnAgency.json
            vatClientInsolvent:
              value:
                $ref: ./examples/errors/forbidden_vatClientInsolvent.json
    badRequestCancelInvitation:
      description: Bad Request
      content:
        application/json:
          schema:
            required:
            - code
            - message
            type: object
            properties:
              code:
                type: string
              message:
                type: string
          examples:
            unsupportedVersion:
              value:
                $ref: ./examples/errors/badReq_invalidVersionAcceptHeader.json
            badRequest:
              value:
                $ref: ./examples/errors/badReq.json
    badRequestCreateInvitation:
      description: Bad Request
      content:
        application/json:
          schema:
            required:
            - code
            - message
            type: object
            properties:
              code:
                type: string
              message:
                type: string
          examples:
            serviceNotSupported:
              value:
                $ref: ./examples/errors/badReq_serviceNotSupported.json
            invalidClientType:
              value:
                $ref: ./examples/errors/badReq_clientTypeNotSupported.json
            invalidClientId:
              value:
                $ref: ./examples/errors/badReq_clientIdFormatInvalid.json
            clientIdDoesNotMatchService:
              value:
                $ref: ./examples/errors/badReq_clientIdServiceMatchError.json
            invalidPostcode:
              value:
                $ref: ./examples/errors/badReq_postcodeFormatInvalid.json
            invalidVatRegistrationDate:
              value:
                $ref: ./examples/errors/badReq_vatRegDateFormatInvalid.json
            unsupportedVersion:
              value:
                $ref: ./examples/errors/badReq_invalidVersionAcceptHeader.json
            unsupportedContentType:
              value:
                $ref: ./examples/errors/badReq_unsupportedContentType.json
            unsupportedAgentType:
              value:
                $ref: ./examples/errors/badReq_unsupportedAgentType.json
            badRequest:
              value:
                $ref: ./examples/errors/badReq.json
    badRequestGetRelationshipStatus:
      description: Bad Request
      content:
        application/json:
          schema:
            required:
            - code
            - message
            type: object
            properties:
              code:
                type: string
              message:
                type: string
          examples:
            serviceNotSupported:
              value:
                $ref: ./examples/errors/badReq_serviceNotSupported.json
            invalidClientId:
              value:
                $ref: ./examples/errors/badReq_clientIdFormatInvalid.json
            clientIdDoesNotMatchService:
              value:
                $ref: ./examples/errors/badReq_clientIdServiceMatchError.json
            invalidPostcode:
              value:
                $ref: ./examples/errors/badReq_postcodeFormatInvalid.json
            invalidVatRegistrationDate:
              value:
                $ref: ./examples/errors/badReq_vatRegDateFormatInvalid.json
            unsupportedVersion:
              value:
                $ref: ./examples/errors/badReq_invalidVersionAcceptHeader.json
            unsupportedContentType:
              value:
                $ref: ./examples/errors/badReq_unsupportedContentType.json
            unsupportedAgentType:
              value:
                $ref: ./examples/errors/badReq_unsupportedAgentType.json
            badRequest:
              value:
                $ref: ./examples/errors/badReq.json
    badRequestGetInvitations:
      description: Bad Request
      content:
        application/json:
          schema:
            required:
            - code
            - message
            type: object
            properties:
              code:
                type: string
              message:
                type: string
          examples:
            unsupportedVersion:
              value:
                $ref: ./examples/errors/badReq_invalidVersionAcceptHeader.json
            badRequest:
              value:
                $ref: ./examples/errors/badReq.json
  parameters:
    arnParameter:
      name: arn
      in: path
      description: "The Making Tax Digital (MTD) platform Agent Reference Number.\
        \ For format and validation of Agent Reference Number [See here](https://github.com/hmrc/agent-authorisation-api/tree/main/app/uk/gov/hmrc/agentauthorisation/models/Arn.scala)"
      required: true
      style: simple
      explode: false
      schema:
        type: string
        example: AARN9999999
    invitationIdParameter:
      name: invitationId
      in: path
      description: A unique authorisation request ID
      required: true
      style: simple
      explode: false
      schema:
        type: string
        example: CS5AK7O8FPC43
    acceptHeader:
      name: Accept
      in: header
      description: "Specifies the response format and the [version](/api-documentation/docs/reference-guide#versioning)\
        \ of the API to be used."
      required: true
      style: simple
      explode: false
      schema:
        type: string
        enum:
        - application/vnd.hmrc.1.0+json
    contentTypeHeader:
      name: Content-Type
      in: header
      description: The media type of the request body.
      required: true
      style: simple
      explode: false
      schema:
        type: string
        enum:
        - application/json
    authHeader:
      name: Authorization
      in: header
      description: "Bearer [SERVER-TOKEN]"
      required: true
      style: simple
      explode: false
      schema:
        type: string
  securitySchemes:
    userRestricted:
      type: oauth2
      description: |
        HMRC supports OAuth 2.0 for authenticating user restricted API requests using an OAuth 2.0 Bearer Token in the AUTHORIZATION header.
        See https://developer.service.hmrc.gov.uk/api-documentation/docs/authorisation/user-restricted-endpoints for details.
      flows:
        authorizationCode:
          authorizationUrl: https://api.service.hmrc.gov.uk/oauth/authorize
          tokenUrl: https://api.service.hmrc.gov.uk/oauth/token
          refreshUrl: https://api.service.hmrc.gov.uk/oauth/refresh
          scopes:
            read:sent-invitations: Grants read access
            read:check-relationship: Grants read access
            write:sent-invitations: Grants write access
            write:cancel-invitations: Grants write access
